<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Uscita furgoni</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
    }

    .app-container {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    h2 {
      margin-top: 0;
      text-align: center;
      font-size: 1.4rem;
      color: #111827;
    }

    .field-group {
      margin-bottom: 14px;
    }

    .field-label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #374151;
    }

    select,
    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      background-color: #f9fafb;
      box-sizing: border-box;
    }

    select:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
      background-color: #ffffff;
    }

    .row-2 {
      display: flex;
      gap: 10px;
    }

    .row-2 .col {
      flex: 1;
    }

    .btn-primary,
    .btn-secondary {
      width: 100%;
      margin-top: 8px;
      padding: 12px;
      font-size: 1rem;
      border: none;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:active {
      background: #1d4ed8;
      transform: scale(0.99);
    }

    .btn-secondary {
      background: #f97316;
      color: white;
    }

    .btn-secondary:active {
      background: #ea580c;
      transform: scale(0.99);
    }

    .info {
      background: #eff6ff;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 0.9rem;
      color: #1d4ed8;
      margin-bottom: 14px;
    }

    .muted {
      color: #6b7280;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="card">
      <h2>Registra corsa furgone</h2>

      {% if corsa_in_corso and corsa %}
        <div class="info">
          Corsa in corso:<br>
          <strong>{{ corsa.autista if corsa.autista is defined else corsa["autista"] }}</strong>
          con furgone
          <strong>{{ corsa.targa if corsa.targa is defined else corsa["targa"] }}</strong><br>
          Partenza da <strong>{{ corsa.partenza if corsa.partenza is defined else corsa["partenza"] }}</strong>
          alle <strong>{{ corsa.data_ora_partenza if corsa.data_ora_partenza is defined else corsa["data_ora_partenza"] }}</strong>
        </div>
      {% endif %}

      <form method="post">
        {% if not corsa_in_corso %}
          <!-- SCHERMATA: INIZIA CORSA -->

          <!-- AUTISTA -->
          <div class="field-group">
            <span class="field-label">Autista</span>
            <select name="autista" required>
              <option value="" disabled selected>Seleziona autista</option>
              <option value="Valerio">Valerio</option>
              <option value="Costantino">Costantino</option>
              <option value="Simone">Simone</option>
              <option value="Stefano">Stefano</option>
            </select>
          </div>

          <!-- FURGONE + TESTO TIPO -->
          <div class="field-group">
            <span class="field-label">Furgone (targa)</span>
            <select id="targa-select" name="targa" required>
              <option value="" disabled selected>Seleziona furgone</option>
              <option value="GA087CH" data-size="piccolo">GA087CH</option>
              <option value="GX942TS" data-size="medio">GX942TS</option>
              <option value="GG862HC" data-size="grosso">GG862HC</option>
            </select>

            <div id="truck-text" class="muted" style="margin-top:6px;">
              Seleziona un furgone
            </div>
          </div>

          <!-- PARTENZA + KM PARTENZA -->
          <div class="field-group">
            <div class="row-2">
              <div class="col">
                <span class="field-label">Partenza</span>
                <select name="partenza" required>
                  <option value="" disabled selected>Seleziona partenza</option>
                  <option value="Tiburtina">Tiburtina</option>
                  <option value="Rieti">Rieti</option>
                  <option value="Cavour Viminale">Cavour Viminale</option>
                  <option value="Via Genova">Via Genova</option>
                  <option value="Policlinico">Policlinico</option>
                  <option value="San Giovanni">San Giovanni</option>
                  <option value="Fontechiari">Fontechiari</option>
                  <option value="Nomentano">Nomentano</option>
                  <option value="Sulmona">Sulmona</option>
                  <option value="Pratica di Mare">Pratica di Mare</option>
                  <option value="Spallanzani">Spallanzani</option>
                  <option value="Avezzano">Avezzano</option>
                  <option value="Castel di Sangro">Castel di Sangro</option>
                  <option value="Fondazione Bietti">Fondazione Bietti</option>
                  <option value="Tor Vergata">Tor Vergata</option>
                  <option value="Studio legale Abrignani">Studio legale Abrignani</option>
                  <option value="ACS Eur">ACS Eur</option>
                  <option value="Teramo">Teramo</option>
                  <option value="L'Aquila">L'Aquila</option>
                </select>
              </div>
              <div class="col">
                <span class="field-label">Km partenza</span>
                <input type="number" name="km_partenza" min="0" step="1" required>
              </div>
            </div>
          </div>

          <p class="muted">Premi ‚ÄúInizia corsa‚Äù per memorizzare questi dati. Alla fine registrerai destinazione e km arrivo.</p>

          <button class="btn-primary" type="submit" name="azione" value="start">
            Inizia corsa
          </button>

        {% else %}
          <!-- SCHERMATA: FINE CORSA -->

          <p class="muted">Compila solo destinazione e km arrivo, poi premi ‚ÄúFine corsa‚Äù.</p>

          <!-- DESTINAZIONE + KM ARRIVO -->
          <div class="field-group">
            <div class="row-2">
              <div class="col">
                <span class="field-label">Destinazione</span>
                <select name="destinazione" required>
                  <option value="" disabled selected>Seleziona destinazione</option>
                  <option value="Tiburtina">Tiburtina</option>
                  <option value="Rieti">Rieti</option>
                  <option value="Cavour Viminale">Cavour Viminale</option>
                  <option value="Via Genova">Via Genova</option>
                  <option value="Policlinico">Policlinico</option>
                  <option value="San Giovanni">San Giovanni</option>
                  <option value="Fontechiari">Fontechiari</option>
                  <option value="Nomentano">Nomentano</option>
                  <option value="Sulmona">Sulmona</option>
                  <option value="Pratica di Mare">Pratica di Mare</option>
                  <option value="Spallanzani">Spallanzani</option>
                  <option value="Avezzano">Avezzano</option>
                  <option value="Castel di Sangro">Castel di Sangro</option>
                  <option value="Fondazione Bietti">Fondazione Bietti</option>
                  <option value="Tor Vergata">Tor Vergata</option>
                  <option value="Studio legale Abrignani">Studio legale Abrignani</option>
                  <option value="ACS Eur">ACS Eur</option>
                  <option value="Teramo">Teramo</option>
                  <option value="L'Aquila">L'Aquila</option>
                </select>
              </div>
              <div class="col">
                <span class="field-label">Km arrivo</span>
                <input type="number" name="km_arrivo" min="0" step="1" required>
              </div>
            </div>
          </div>

          <button class="btn-secondary" type="submit" name="azione" value="stop">
            Fine corsa
          </button>
        {% endif %}
      </form>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const select = document.getElementById("targa-select");
      if (!select) return;

      const info = document.getElementById("truck-text");

      function aggiornaTesto() {
        const option = select.options[select.selectedIndex];
        const size = option ? option.getAttribute("data-size") : null;

        if (!size) {
          info.textContent = "Seleziona un furgone";
          return;
        }

        if (size === "piccolo") {
          info.textContent = "üöö Furgone piccolo";
        } else if (size === "medio") {
          info.textContent = "üööüöö Furgone medio";
        } else if (size === "grosso") {
          info.textContent = "üööüööüöö Furgone grosso";
        }
      }

      select.addEventListener("change", aggiornaTesto);
      aggiornaTesto();
    });
  </script>
</body>
</html>


