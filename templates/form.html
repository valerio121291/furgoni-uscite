<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Centrale Operativa Furgoni</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
    .header { text-align: center; margin-bottom: 20px; color: #1e293b; }
    
    /* DASHBOARD IN ALTO */
    .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 25px; }
    .truck-card { background: white; padding: 12px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 5px solid #ccc; }
    .truck-card.In.Viaggio { border-top-color: #f97316; } /* Arancione se viaggia */
    .truck-card.Libero { border-top-color: #059669; }    /* Verde se libero */
    .targa-box { font-weight: bold; font-size: 1rem; color: #334155; }
    .status-tag { font-size: 0.65rem; font-weight: bold; text-transform: uppercase; padding: 2px 8px; border-radius: 50px; color: white; margin: 5px 0; display: inline-block; }
    .Libero .status-tag { background: #059669; }
    .In.Viaggio .status-tag { background: #f97316; }
    .km-label { font-size: 0.8rem; color: #64748b; display: block; margin-top: 2px; }
    .alert-msg { color: #dc2626; font-size: 0.7rem; font-weight: bold; margin-top: 5px; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0.5; } }

    /* FORM REGISTRAZIONE */
    .main-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    h3 { margin: 0 0 15px 0; color: #1e293b; font-size: 1.1rem; text-align: center; }
    label { font-size: 0.85rem; font-weight: 600; color: #475569; display: block; margin-top: 10px; }
    select, input, button { width: 100%; padding: 12px; margin-top: 5px; border-radius: 8px; border: 1px solid #cbd5e1; box-sizing: border-box; font-size: 1rem; }
    button { background: #2563eb; color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; }
    button:active { transform: scale(0.98); }
    .btn-step { background: #f97316; }
    .btn-stop { background: #059669; }
    
    .hidden { display: none; }
  </style>
</head>
<body>

  <div class="header">
    <h2>üöö Logistica 2026</h2>
  </div>

  <div class="status-grid">
    {% for targa, info in furgoni.items() %}
    <div class="truck-card {{ info.stato }}">
      <span class="targa-box">{{ targa }}</span>
      <span class="status-tag">{{ info.stato }}</span>
      <span class="km-label">üìç {{ info.posizione }}</span>
      <span class="km-label">üèÅ {{ info.km }} KM</span>
      {% if info.alert %}<div class="alert-msg">{{ info.alert }}</div>{% endif %}
    </div>
    {% endfor %}
  </div>

  <div class="main-card">
    <form method="post">
      <h3>Registra Attivit√†</h3>
      
      <label>Quale furgone stai usando?</label>
      <select name="targa" id="targa-select" required onchange="toggleForm()">
        <option value="" disabled selected>Seleziona targa...</option>
        {% for targa, info in furgoni.items() %}
          <option value="{{ targa }}" data-stato="{{ info.stato }}">{{ targa }} ({{ info.stato }})</option>
        {% endfor %}
      </select>

      <div id="form-start" class="hidden">
        <label>Autista</label>
        <select name="autista">
          <option value="Valerio">Valerio</option>
          <option value="Costantino">Costantino</option>
          <option value="Simone">Simone</option>
          <option value="Stefano">Stefano</option>
          <option value="Daniele">Daniele</option>
        </select>
        
        <label>Punto di Partenza</label>
        <select name="partenza">
          <option value="Tiburtina" selected>Tiburtina</option>
          <option value="Rieti">Rieti</option>
          <option value="Cavour Viminale">Cavour Viminale</option>
          <option value="Via Genova">Via Genova</option>
          <option value="L'Aquila">L'Aquila</option>
          <option value="Teramo">Teramo</option>
        </select>
        
        <label>KM Partenza</label>
        <input type="number" name="km_partenza" placeholder="KM cruscotto">
        <button type="submit" name="azione" value="start">INIZIA VIAGGIO</button>
      </div>

      <div id="form-update" class="hidden">
        <label>Cosa devi registrare?</label>
        <select id="azione-update" onchange="updateActionFields()">
            <option value="arrivo_dest">Arrivo a Destinazione (Met√† Corsa)</option>
            <option value="stop">Rientro alla Base (Fine Corsa)</option>
        </select>

        <div id="fields-arrivo">
            <label>Punto di Arrivo</label>
            <select name="destinazione">
              <option value="Rieti">Rieti</option>
              <option value="Tiburtina">Tiburtina</option>
              <option value="Cavour Viminale">Cavour Viminale</option>
              <option value="L'Aquila">L'Aquila</option>
              <option value="Teramo">Teramo</option>
            </select>
            <label>KM Arrivo</label>
            <input type="number" name="km_destinazione" placeholder="KM arrivo">
            <button type="submit" name="azione" value="arrivo_dest" class="btn-step">REGISTRA ARRIVO</button>
        </div>

        <div id="fields-stop" class="hidden">
            <label>KM Rientro Finali</label>
            <input type="number" name="km_rientro" placeholder="KM finali base">
            <button type="submit" name="azione" value="stop" class="btn-stop">CHIUDI E SCARICA PDF</button>
        </div>
      </div>
    </form>
  </div>

  <script>
    function toggleForm() {
      const select = document.getElementById('targa-select');
      const stato = select.options[select.selectedIndex].getAttribute('data-stato');
      
      document.getElementById('form-start').classList.toggle('hidden', stato !== 'Libero');
      document.getElementById('form-update').classList.toggle('hidden', stato !== 'In Viaggio');
    }

    function updateActionFields() {
      const val = document.getElementById('azione-update').value;
      document.getElementById('fields-arrivo').classList.toggle('hidden', val !== 'arrivo_dest');
      document.getElementById('fields-stop').classList.toggle('hidden', val !== 'stop');
    }
  </script>
</body>
</html>

 
