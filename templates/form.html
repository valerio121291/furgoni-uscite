<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestione Viaggi Furgoni</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; background: #f3f4f6; margin: 0; padding: 0; }
    .app-container { max-width: 480px; margin: 0 auto; padding: 16px; }
    .card { background: #ffffff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    h2 { margin-top: 0; text-align: center; font-size: 1.4rem; color: #111827; border-bottom: 2px solid #eee; padding-bottom: 10px; }
    .field-group { margin-bottom: 14px; }
    .field-label { display: block; margin-bottom: 4px; font-size: 0.9rem; font-weight: 600; color: #374151; }
    select, input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 1rem; background-color: #f9fafb; box-sizing: border-box; }
    .btn { width: 100%; padding: 14px; font-size: 1rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; color: white; margin-top: 10px; }
    .btn-start { background: #2563eb; }
    .btn-step { background: #f97316; }
    .btn-stop { background: #059669; }
    .info-box { background: #eff6ff; border-radius: 8px; padding: 12px; font-size: 0.9rem; color: #1d4ed8; margin-bottom: 14px; border-left: 4px solid #2563eb; }
    #loading { display: none; text-align: center; margin-top: 15px; color: #6b7280; font-weight: bold; }
    .step-title { color: #6b7280; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 10px; display: block; }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="card">
      <h2>Diario di Bordo</h2>

      <form method="post" id="main-form">
        
        {% if not corsa_in_corso %}
          <span class="step-title">Fase 1: Partenza dalla Base</span>
          <div class="field-group">
            <span class="field-label">Autista</span>
            <select name="autista" required>
              <option value="" disabled selected>Chi guida?</option>
              <option value="Valerio">Valerio</option>
              <option value="Costantino">Costantino</option>
              <option value="Simone">Simone</option>
              <option value="Stefano">Stefano</option>
              <option value="Daniele">Daniele</option>
            </select>
          </div>
          <div class="field-group">
            <span class="field-label">Furgone</span>
            <select name="targa" required>
              <option value="GA087CH">GA087CH (Piccolo)</option>
              <option value="GX942TS">GX942TS (Medio)</option>
              <option value="GG862HC">GG862HC (Grosso)</option>
            </select>
          </div>
          <div class="field-group">
            <span class="field-label">Punto di Partenza</span>
            <input type="text" name="partenza" value="Tiburtina" required>
          </div>
          <div class="field-group">
            <span class="field-label">KM Partenza</span>
            <input type="number" name="km_partenza" placeholder="Inserisci KM attuali" required>
          </div>
          <button class="btn btn-start" type="submit" name="azione" value="start">INIZIA VIAGGIO</button>

        {% elif corsa.stato == 'in_viaggio' %}
          <div class="info-box">
            üöó <b>Viaggio in corso...</b><br>
            {{ corsa.autista }} su {{ corsa.targa }}<br>
            Partito da {{ corsa.partenza }} alle {{ corsa.data_p }}
          </div>
          <span class="step-title">Fase 2: Arrivo a Destinazione</span>
          <div class="field-group">
            <span class="field-label">Dove sei arrivato?</span>
            <input type="text" name="destinazione" placeholder="es. Rieti, L'Aquila..." required>
          </div>
          <div class="field-group">
            <span class="field-label">KM all'Arrivo</span>
            <input type="number" name="km_destinazione" placeholder="KM segnati sul cruscotto" required>
          </div>
          <button class="btn btn-step" type="submit" name="azione" value="arrivo_dest">REGISTRA ARRIVO</button>

        {% elif corsa.stato == 'arrivato' %}
          <div class="info-box">
            üìç <b>Fermo a {{ corsa.destinazione }}</b><br>
            Arrivato alle {{ corsa.data_d }} con {{ corsa.km_d }} KM.
          </div>
          <span class="step-title">Fase 3: Rientro alla Base</span>
          <div class="field-group">
            <span class="field-label">KM Finali (al rientro a {{ corsa.partenza }})</span>
            <input type="number" name="km_rientro" placeholder="KM al rientro" required>
          </div>
          <button class="btn btn-stop" type="submit" name="azione" value="stop" onclick="showLoading()">CHIUDI GIRO E SCARICA PDF</button>
          <div id="loading">‚è≥ Elaborazione dati e PDF...</div>
        {% endif %}

      </form>
    </div>
  </div>

  <script>
    function showLoading() {
      document.getElementById('loading').style.display = 'block';
    }
  </script>
</body>
</html>
               
